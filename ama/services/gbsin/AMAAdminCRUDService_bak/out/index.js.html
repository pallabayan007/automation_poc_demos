<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/*var mongo = require('mongodb');
var MongoClient = mongo.MongoClient;
var mongodb_uri;
if (process.env.VCAP_SERVICES) {
	var env = JSON.parse(process.env.VCAP_SERVICES);
	logger.info(JSON.stringify(process.env.VCAP_SERVICES));
	if (env['mongolab'] &amp;&amp; env['mongolab'][0]) {
		mongodb_uri = env['mongolab'][0]['credentials']["uri"];
		logger.info("Connected to Bluemix Mongo DB");
	}
}
else {
	mongodb_uri = appProperty['deployment-specific-properties']['ON_PREM'].dbConnectionURL;
	logger.info("Connected to Local Mongo DB")
}
logger.info("DB:" + mongodb_uri);*/

var logger = getLogger("DB");
var appProperty= require('../../../../config/app_config.json');
var initdbdata=require('../../../../config/DB/initialDBData.json');



// ----------------------- Start  -----------------
var express = require('express');
var app = express();

var http = require("http");
var models = require("../../../../models");
var errorcodes = require('../../../../config/errorcodes.json');
var userMsg = require('../../../../config/user_message.json');
var msg = require('../../../../config/message.js');
var mongoose = require('mongoose');
var cors = require('cors');
app.use(cors());


var UsersAccessModel=models.UserAccess;
var RolesModel=models.Role;
var CapabilitiesModel=models.Capability;
var AccountsModel = models.Account;
var ApplicationsModel = models.Application;
var ClientsModel=models.Client;
var UserCredentialModel=models.UserCredential;


var updateFlag=false;


/*exports.Test=function(req,res){
	var aa=msg.successMessage('Asansol');
	logger.info('Test Global message '+ aa);
	return res.status(200).send(aa);
}*/


/**
 * url :/rest/v1/adminmeta/CreateUserAccess
 * Description :Create new record for user access
 * Method : POST
 */
exports.CreateUserAccess = function (req, res){
	
	
	
	//-----------------------------------------------------------------------------------------------
	var uid=req.body.userID;
	UsersAccessModel.findOne({"userID":uid}).lean().exec(function (err, users) {
	    if (err) {	
	    	//throw new Error('DBError');
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
	    	return;
	    	//res.status(500).send(err);
	    }
	    else if(!users)
	    	{
	    		var user = new UsersAccessModel({
	    		//_id: mongoose.Types.ObjectId(),
	    		  userName: req.body.userName,
	    		  userID:req.body.userID,
	    		  roleName: req.body.roleName, 
	    		  account: req.body.account, 
	    		  type: req.body.type, 
	    		  active: req.body.active,
	    		  email:req.body.email,
	    		  updateTimestamp:new Date().toISOString(),
	    		  updatedByUserId: req.body.updatedByUserId, 
	    		  updateComment: req.body.updateComment,
	    		  trashed:'n',

	    	    });
	    	  user.save(function (err) {
	    	    if (err) {
	    	    	var errorCode=errorcodes["DBError"];
	    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	    	return;
	    	    } else {
	    	          var msgJson=msg.successMessage("CreateUser","0","UsersAccess details created successfully","UsersAccess details created successfully",user);
	    	    	  return res.status(200).send(msgJson);
	    	    }
	    	  });
	    	}
	    else {
	    	  var userMessage=userMsg.adminDuplicateUser;
	    	  var msgJson=msg.successMessage("CreateUser","1",userMessage,userMessage,{});
	    	  return res.status(400).send(msgJson);
	    }
	  });
	//------------------------------------------------------------------------------------------------
	
	  
	  //return res.send(user); 	
	}


/**
 * url :/rest/v1/adminmeta/UpdateUserAccess
 * Description :Updatespecific record for user access
 * Method : PUT
 */
exports.UpdateUserAccess = function (req, res){
	 UsersAccessModel.findById(req.query.Id, function (err, user) {
		 var oldtimestamp=req.body.updateTimestamp;
		 logger.info('request body ------------------------'+oldtimestamp);
		 var newtimestamp=user.updateTimestamp.toISOString();
		 logger.info('user fetch ==========================='+newtimestamp);
		 logger.info('current Date '+new Date().toISOString());
		 user.userName=req.body.userName;
		 user.userID=req.body.userID;
		 user.roleName= req.body.roleName;
		 user.account= req.body.account;
		 user.type= req.body.type;
		 user.active=req.body.active;
		 user.email=req.body.email;
		 user.updateTimestamp=new Date().toISOString();
		 user.updatedByUserId= req.body.updatedByUserId;
		 user.updateComment=req.body.updateComment;
		 if(oldtimestamp==newtimestamp)
			 {
			 user.save(function (err) {
			      if (err) {
			    	  /*logger.info("My Error "+err);
				    	//return res.status(500).send(err);
			    	  throw new Error('DBError');*/
			    	  var errorCode=errorcodes["DBError"];
				    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
				    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
				    	return;
			      } else {
			    	  
			          var msgJson=msg.successMessage("UpdateUser","0","UsersAccess details updated successfully","UsersAccess details updated successfully",user);
			    	  return res.status(200).send(msgJson);
			      }
			    });
			 }
		 else
			 {
			 
			  var userMessage=userMsg.adminUpdateUserConflict;
			  var obj={};
			  var msgJson=msg.successMessage("UpdateUser","1",userMessage,userMessage,obj);
	    	  return res.status(400).send(msgJson);
			 }
		  
	  });
	}



/**
 * url :/rest/v1/adminmeta/DeleteUserAccess
 * Description :Delete specific record for user access
 * Method : DELETE
 */
exports.DeleteUserAccess = function (req, res){
	   UsersAccessModel.findById(req.query.Id, function (err, usr) {
	      if(err)
	        {
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	        }
	      else if(!usr)
	        {
	          //return res.status(404).send('User not found');
	    	  //throw new Error('UserIdInvalid');
	    	  var errorCode=errorcodes["UserIdInvalid"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	        }
	      else
	        {
	        /*usr.remove(function (err) {
	            if (err) {
	              logger.info("My Error during remove "+err);
	              return res.status(500).send(err);
	            	var errorCode=errorcodes["DBError"];
			    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
			    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
			    	return;
	            } else {
	  	        var msgJson=msg.successMessage("DeleteUser","0","UsersAccess details deleted successfully","UsersAccess details deleted successfully",usr);
	  	    	  return res.status(200).send(msgJson);
	            }
	            
	          });*/
	    	  usr.trashed='y';
	    	  usr.updateTimestamp=new Date().toISOString();
	    	  usr.save(function (err) {
	    	      if (err) {
	    	    	  var errorCode=errorcodes["DBError"];
		    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	    	return;
	    	      } else {
	    	          var msgJson=msg.successMessage("DeleteUserAccess","0","UserAccess deleted successfully","UserAccess deleted successfully",usr);
	    	    	  return res.status(200).send(msgJson);
	    	      }
	    	    });
	        }
	    });
	  }


/**
 * url :/rest/v1/adminmeta/GetUserAccess
 * Description :Get specific record for user access
 * Method : GET
 */
exports.GetUserAccess = function (req, res){
	var uid = req.query.userID;
	//logger.info("USer id ="+uid);
	UsersAccessModel.findOne({"userID":uid,"trashed": 'n'}).lean().exec(function (err, users) {
	    if (err) {	
	    	//throw new Error('DBError');
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
	    	return;
	    	//res.status(500).send(err);
	    }
	    else if(!users)
	    	{
	    		logger.info('GetUserAccess Exception handling.');
	    		logger.info(users);
	    		var errorCode=errorcodes["UserIdInvalid"];
	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
	    		return;
	    	}
	    else {
	    	
	    	/*logger.info('Get the user Details --------------------->');
	    	logger.info(users)*/;
	    	/*AccountsModel.findOne({"_id":users.accountID,"trashed": 'n'}).lean().exec(function (err, accounts) {
	    	    if (err) {	    	
	    	    	var errorCode=errorcodes["DBError"];
	    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	    	return;
	    	    }
	    	    else if(!accounts)
		    	{
		    		logger.info('GetUserAccess Account Exception handling.');
		    		logger.info(users);
		    		var errorCode=errorcodes["AccountIdInvalid"];
		    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
		    		return;
		    	}
	    	    else {
	    	      users["accountName"]=accounts.accountName;
	    	      var msgJson=msg.successMessage("GetUser","0","Fetching user Details","Fetching user Details",users);
	  	    		return res.status(200).send(msgJson);
	    	    }
	    	  });*/
	    		
	    		collectAccountApplicationName(users,0,res,req);
	    	
	    }
	  });
	
}


/**
 * url :/rest/v1/adminmeta/GetAllUserAccess
 * Description :Get all the records of user access
 * Method : GET
 */
exports.GetAllUserAccess = function (req, res){
	    UsersAccessModel.find({"trashed": 'n'}).exec(function (err, users) {
	      if (err) {       
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	      } else {
	          var msgJson=msg.successMessage("GetAllUser","0","List of  user access  details","List of  user access  details",users);
	    	  return res.status(200).send(msgJson);
	      }
	    });
	  }


/**
 * url :/rest/v1/adminmeta/GetAllUserName
 * Description :Get the List of  all username
 * Method : GET
 */
exports.GetAllUserName=function(req,res){
	UsersAccessModel.find({"trashed": 'n'}).distinct('userID', function(error, users) {
	      if (error) {
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	      } else {
	    	  var msgJson=msg.successMessage("GetAllUserName","0","List of  all username","List of  all username",users);
	    	  return res.status(200).send(msgJson);
	      }
	    });
}


/**
 * url :/rest/v1/adminmeta/SearchUserAccess
 * Description :Get the specific useraccess record based on userid
 * Method : GET
 */
exports.SearchUserAccess=function(req,res){
	UsersAccessModel.findOne({userID:req.query.userID,"trashed": 'n'}).lean().exec(function (err, users) {
	    if(err)
	      {
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	return;
	      }
	      else if(!users)
	      {
	    	  logger.info('SearchUserAccess Exception handling.');
	    	  logger.info(users);
	    	  var errorCode=errorcodes["UserIdInvalid"];
	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
	    		return;
	      }
	      else
	      {
	        var msgJson=msg.successMessage("SearchUserAccess","0","UserName searched successfully","UserName searched successfully",users);
	        return res.status(200).send(msgJson);
	      }
	  });
}


/**
 * url :/rest/v1/adminmeta/CreateRole
 * Description :Create a new Role record
 * Method : POST
 */
exports.CreateRole = function (req, res){

	RolesModel.findOne({"roleName":req.body.roleName}).lean().exec(function (err, rol) {
		if(err)
			{
				var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
			}
		else if(!rol)
			{
			var obj=req.body;
			logger.info('arijit chatterjee');
			logger.info(req.body);
			  var role = new RolesModel({
				//_id: mongoose.Types.ObjectId(),
				  roleName: req.body.roleName, 
				  roleDescription: req.body.roleDescription,  
				  updateTimestamp:new Date().toISOString(), 
				  updatedByUserId: req.body.updatedByUserId, 
				  updateComment: req.body.updateComment,
				  capabilityNameList:req.body.capabilityNameList,
				  trashed:'n',

			    });
			  role.save(function (err) {
			    if (err) {
			    	var errorCode=errorcodes["DBError"];
			    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
			    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
			    	return;
			    	
			    } else {
			    	
			    	var capArr = req.body.Capabilities;
			    	logger.info('My arr '+capArr);
			    	createCapability(capArr,0,res,obj,req);
			    }
			  });
			}
		else
			{
				var userMessage=userMsg.adminDuplicateRole;
				var msgJson=msg.successMessage("CreateRole","1",userMessage,userMessage,obj);
				return res.status(400).send(msgJson);
			}
	});
	
	}

/**
 * Description :Create a new capability associate with a role.
 */
function createCapability(capNamelist,i,res,obj,req){
	/*logger.info('step2');
	logger.info(capNamelist);
	logger.info('i ='+i);*/
	if(i&lt;capNamelist.length)
		{
		var capElem = capNamelist[i];
		var capability = new CapabilitiesModel({
			  capName: capElem.capName,
			  capRegStr: capElem.capRegStr,
			  accessPanel:capElem.accessPanel,
			  updateTimestamp:new Date().toISOString(),
			  trashed:'n',
		    });
		  capability.save(function (err) {
		    if (err) {
		    	/*logger.info("My Error "+err);
		    	return res.status(500).send(err);
		    	throw new Error('DBError');*/
		    	var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
		    } else {
		          i=i+1;
		          createCapability(capNamelist,i,res,obj,req);
		    }
		  });
		}
	else
		{
			var msgJson=msg.successMessage("CreateRole","0","Role created successfully","Role created successfully",obj);
			return res.status(200).send(msgJson);
		}
}


/**
 * url :/rest/v1/adminmeta/UpdateRole
 * Description :Update a specific Role record
 * Method : PUT
 */
exports.UpdateRole = function (req, res){
	var obj=req.body;
	logger.info('update role');
	logger.info(req.body);
	 RolesModel.findById(req.query.Id, function (err, role) {
		 logger.info('Fetching role data==========>');
		 logger.info(role);
		 var oldtimestamp=req.body.updateTimestamp;
		 logger.info('request body ------------------------'+oldtimestamp);
		 var newtimestamp=role.updateTimestamp.toISOString();
		 logger.info('user fetch ==========================='+newtimestamp);
		 logger.info('current Date '+new Date().toISOString());
		 
		 role.roleName=req.body.roleName;
		 role.roleDescription=req.body.roleDescription;  
		 role.updateTimestamp=new Date().toISOString(); 
		 role.updatedByUserId=req.body.updatedByUserId;
		 role.updateComment= req.body.updateComment;
		 role.capabilityNameList=(req.body.capabilityNameList).toString();

		 if(oldtimestamp==newtimestamp)
		 {
			 role.save(function (err) {
			      if (err) {
			    	  var errorCode=errorcodes["DBError"];
				    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
				    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
				    	return;
			      } else {
			    	  	
			    	  var capArr = req.body.Capabilities;
				    	logger.info('My arr '+capArr);
				    	updateCapability(capArr,0,res,obj)
			          /*var msgJson=successMessage("UpdateRole","0","Role updated successfully","Role updated successfully",role);
			    	  return res.status(200).send(msgJson);*/
			      }
			    });
		 }
	 else
		 {
		   var userMessage=userMsg.adminUpdateRoleConflict;
		   var obj1={};
		   var msgJson=msg.successMessage("UpdateRole","1",userMessage,userMessage,obj1);
    	   return res.status(400).send(msgJson);
		 }
		 
		 
	  });
	}


/**
 * Description :Update a specific capability associate with a role.
 */
function updateCapability(capNamelist,i,res,obj){
	if(i&lt;capNamelist.length)
		{
			var capElem = capNamelist[i];
			logger.info('qwerty =');
			logger.info(capElem);
			logger.info(capElem._id);
			if(capElem._id=='')
				delete capElem['_id'];
			//var capElem = capNamelist[i];
			logger.info('new capelem ==');
			logger.info(capElem);
			CapabilitiesModel.findById(capElem._id, function (err, cap) {
				 if(err)
		         {
					 logger.info('Find Error 1');
		          logger.info(err);
		          return res.status(500).send(err);
		         }
		         else if(!cap)
		         {
		        	 logger.info('Find Error 12');
		            
		            var cap = new CapabilitiesModel({
		            capName: capElem.capName,
		            capRegStr: capElem.capRegStr,
		            accessPanel:capElem.accessPanel,
		            updateTimestamp:new Date().toISOString(),
		            trashed:'n',
		            });
		            cap.save(function (err) {
		                if (err) {
		                  var errorCode=errorcodes["DBError"];
		                  res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		                  internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		                  return;
		                } 
		                else {
		                  i=i+1;
		                  updateCapability(capNamelist,i,res,obj);
		                }
		              });
		         }
		         else
		         {
		            cap.capName=capElem.capName;
		            cap.capRegStr=capElem.capRegStr;
		            cap.accessPanel=capElem.accessPanel;
		            cap.updateTimestamp=new Date().toISOString(); ; 
		             cap.updatedByUserId=capElem.updatedByUserId;
		             cap.updateComment= capElem.updateComment;

		             cap.save(function (err) {
		                if (err) {
		                  //throw new Error('DBError');
		                  //return res.status(500).send(err);
		                  var errorCode=errorcodes["DBError"];
		                  res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		                  internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		                  return;
		                } else {
		                  i=i+1;
		                  updateCapability(capNamelist,i,res,obj);
		                }
		              });
		          }
			  });
		
		}
	else
		{
			var msgJson=msg.successMessage("UpdateRole","0","Role updated successfully","Role updated successfully",obj);
			return res.status(200).send(msgJson);
		}
}


/**
 * url :/rest/v1/adminmeta/DeleteRole
 * Description :Delete a specific Role record
 * Method : DELETE
 */
exports.DeleteRole = function (req, res){
	   RolesModel.findById(req.query.Id, function (err, role) {
	      if(err)
	        {
	    	  logger.info("My Error "+err);
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	        }
	      else if(!role)
	        {
	    	  var errorCode=errorcodes["RoleIdInvalid"];
	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
	    		return;
	        }
	      else
	        {
	    	  /*role.remove(function (err) {
	            if (err) {
	            	var errorCode=errorcodes["DBError"];
	    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	    	return;
	            } 
	            else {
	  	        var msgJson=msg.successMessage("DeleteRole","0","Role deleted successfully","Role deleted successfully",role);
	  	    	  return res.status(200).send(msgJson);
	            }
	            
	          });*/
	    	  
	    	  role.trashed='y';
	    	  role.updateTimestamp=new Date().toISOString();
	    	  role.save(function (err) {
	    	      if (err) {
	    	    	  var errorCode=errorcodes["DBError"];
		    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	    	return;
	    	      } else {
	    	          var msgJson=msg.successMessage("DeleteRole","0","Role deleted successfully","Role deleted successfully",role);
	    	    	  return res.status(200).send(msgJson);
	    	      }
	    	    });
	        }
	    });
	  }


/**
 * url :/rest/v1/adminmeta/GetRole
 * Description :get a specific Role record based on _id
 * Method : GET
 */
exports.GetRole = function (req, res){
	var rid = req.query.Id;
	logger.info("Role id ="+rid);
	RolesModel.findOne({"_id":rid,"trashed": 'n'}).exec(function (err, role) {
	    if (err) {	
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	return;
	    }
	    else if(!role)
	    	{
	    		//throw new Error('RoleIdInvalid');
	    		var errorCode=errorcodes["RoleIdInvalid"];
	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
	    		return;
	    	}
	    else {
	          var msgJson=msg.successMessage("GetRole","0","Fetching role Details","Fetching role Details",role);
	    	return res.status(200).send(msgJson);
	    }
	  });
	
}


/**
 * url :/rest/v1/adminmeta/GetAllRoles
 * Description :get list of  Role records.
 * Method : GET
 */
exports.GetAllRoles = function (req, res){
	RolesModel.find({"trashed": 'n'}).exec(function (err, role) {
	      if (err) {       
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	      } else {
	          var msgJson=msg.successMessage("GetAllRole","0","List of  role  details","List of  role  details",role);
	    	  return res.status(200).send(msgJson);
	      }
	    });
	  }


/**
 * url :/rest/v1/adminmeta/SearchRole
 * Description :get specific  Role record based on role name.
 * Method : GET
 */
exports.SearchRole=function(req,res){

	  RolesModel.findOne({"roleName":req.query.roleName,"trashed": 'n'}).lean().exec(function (err, roles) {
	    if (err) {       
	      /*throw new Error('DBError');*/
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	return;
	    }
	    else if(!roles)
	      {
	    	var errorCode=errorcodes["RoleNameInvalid"];
    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
    		return;
	      }
	    else {
	    	var capListArr=[];
	    	var newArr=[];
	    	var capList=roles.capabilityNameList;
	    	if(capList!=''&amp;&amp; capList!=undefined)  
	    	  capListArr=capList.split(",");
	    	getRoleCapList(roles,capListArr,0,res,newArr,req);
	      //return res.status(200).send(users);
	    }
	  });
	}


/**
 * url :/rest/v1/adminmeta/GetAllRoleName
 * Description :get all the distinct rolename.
 * Method : GET
 */
exports.GetAllRoleName=function(req,res){
	RolesModel.find({"trashed": 'n'}).distinct('roleName', function(error, users) {
	      if (error) {
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	      } else {
	    	  var msgJson=msg.successMessage("GetAllRoleName","0","List of  all rolename","List of  all rolename",users);
	    	  return res.status(200).send(msgJson);
	      }
	    });
  }

	function getRoleCapList(roles,capListArr,i,res,newArr,req){
		/*logger.info('Testing the issue');
		logger.info(capListArr.length);
		logger.info(capListArr);*/
	  if(i&lt;capListArr.length){
	    var cname=capListArr[i];
	    CapabilitiesModel.findOne({"capName":cname,"trashed": 'n'}).lean().exec(function (err, cap) {
	              if (err) {       
	            	  var errorCode=errorcodes["DBError"];
	      	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	      	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	      	    	return;
	              }
	              else if(!cap){
	                  /*logger.info("My Error65 "+cap);
	                  throw new Error('CapabilityIdInvalid');*/
	                  var errorCode=errorcodes["CapabilityIdInvalid"];
	  	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	  	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
	  	    		return;
	              }  
	              else {
	                newArr.push(cap);
	                i=i+1;
	                getRoleCapList(roles,capListArr,i,res,newArr,req)
	                
	              }
	            });
	  }
	  else
	  {
	    roles.Capabilities=newArr;
	    var msgJson=msg.successMessage("SearchRole","0","Role searched successfully","Role searched successfully",roles);
	    return res.status(200).send(msgJson);
	  }

	  }
	
/*exports.CreateCapability = function (req, res){
	
	  var capability = new CapabilitiesModel({
		  capName: req.body.capName,
		  capRegStr: req.body.capRegStr,
	    });
	  capability.save(function (err) {
	    if (err) {
	    	logger.info("My Error "+err);
	    	return res.status(500).send(err);
	    	throw new Error('DBError');
	    } else {
	          var msgJson=successMessage("CreateCapability","0","Capability created successfully","Capability created successfully",capability);
	    	  return res.status(200).send(msgJson);
	    }
	  });
	}

exports.UpdateCapability = function (req, res){
	 CapabilitiesModel.findById(req.query.Id, function (err, cap) {
		 cap.capName=req.body.capName;
		 cap.capRegStr=req.body.capRegStr;
		 cap.updateTimestamp=req.body.updateTimestamp; 
		 cap.updatedByUserId=req.body.updatedByUserId;
		 cap.updateComment= req.body.updateComment;

	 cap.save(function (err) {
	      if (err) {
	    	  throw new Error('DBError');
	      } else {
	          var msgJson=successMessage("UpdateCapability","0","Capability updated successfully","Capability updated successfully",cap);
	    	  return res.status(200).send(msgJson);
	      }
	    });
	  });
	}*/


	
/**
 * url :/rest/v1/adminmeta/DeleteCapability
 * Description :delete a specific rolename.
 * Method : DELETE
*/
exports.DeleteCapability = function (req, res){
	   CapabilitiesModel.findById(req.query.Id, function (err, cap) {
	      if(err)
	        {
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	        }
	      else if(!cap)
	        {
	    	  
	    	  var errorCode=errorcodes["CapabilityIdInvalid"];
	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
	    		return;
	        }
	      else
	        {
	    	  /*cap.remove(function (err) {
	            if (err) {
	            	var errorCode=errorcodes["DBError"];
	    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	    	return;
	            } else {
	  	          var msgJson=msg.successMessage("DeleteCapability","0","Capability deleted successfully","Capability deleted successfully",cap);
	  	    	  return res.status(200).send(msgJson);
	            	
	            }
	            
	          });*/
	    	  cap.trashed='y';
	    	  cap.updateTimestamp=new Date().toISOString();
	    	  cap.save(function (err) {
	    	      if (err) {
	    	    	  var errorCode=errorcodes["DBError"];
		    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	    	return;
	    	      } else {
	    	          var msgJson=msg.successMessage("DeleteCapability","0","Capability deleted successfully","Capability deleted successfully",cap);
	    	    	  return res.status(200).send(msgJson);
	    	      }
	    	    });
	    	  
	        }
	    });
	  }

/**
 * url :/rest/v1/adminmeta/GetCapability
 * Description :get a specific capability name based on id.
 * Method : GET
*/
exports.GetCapability = function (req, res){
	var cid = req.query.Id;
	logger.info("Capability id ="+cid);
	CapabilitiesModel.findOne({"_id":cid,"trashed": 'n'}).exec(function (err, cap) {
	    if (err) {	
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	return;
	    }
	    else if(!cap)
	    	{
	    	var errorCode=errorcodes["CapabilityIdInvalid"];
    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
    		return;
	    	}
	    else {
	          var msgJson=msg.successMessage("GetCapability","0","Fetching capability Details","Fetching capability Details",cap);
	    	return res.status(200).send(msgJson);
	    }
	  });
	
}


/**
 * url :/rest/v1/adminmeta/GetAllCapability
 * Description :get list of  capability records.
 * Method : GET
*/
exports.GetAllCapability = function (req, res){
	CapabilitiesModel.find({"trashed": 'n'}).exec(function (err, cap) {
	      if (err) {       
	    	  var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
	      } else {
	          var msgJson=msg.successMessage("GetAllCapability","0","List of  capability  details","List of  capability  details",cap);
	    	  return res.status(200).send(msgJson);
	      }
	    });
	  }


function collectAccountApplicationName(user,i,res,req){
	//logger.info('collectAccountApplicationName---------------->'+i);
	if(i &lt; user.account.length)
	{
		var tempArry=[];
		var accountId = user.account[i].accountId;
		logger.info('AccountID---------------->'+i+'------------->'+accountId);
		  AccountsModel.findOne({"_id":accountId,"trashed": 'n'}).lean().exec(function (err, accounts) {
		    if (err) {	
		    	
		    	var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
		    } 
		    else if(!accounts)
		    	{
		    	/*var errorCode=errorcodes["AccountIdInvalid"];
  	    		res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
  	    		internalMessage:errorCode.internalMessage,userMessage:errorCode.userMessage,response:{}});
  	    		return;*/
		    	i=i+1;
				collectAccountApplicationName(user,i,res,req);
		    	}
		    else {
		      logger.info('Value of i -------->'+i);
		      logger.info(accounts);
			  user.account[i].accountName=accounts.accountName;
			  ApplicationsModel.find({'_id': { $in:user.account[i].applicationIdList },'trashed': 'n'}).lean().exec(function (err,application) {
				    if (err) {
				    	var errorCode=errorcodes["DBError"];
				    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
				    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
				    	return;
				    	
				    } else {
				    	logger.info('**********************APPName');
				    	logger.info(application);
				    	var tempArry=[];
				    	for(var k=0;k&lt;application.length;k++)
			    		{
			    			var tempJson={};
			    			var appID=application[k]._id;
			    			var appname=application[k].applicationName;
			    			logger.info('ApplicationName---------------->'+i+'------------->'+appname);
			    			tempJson.applicationId=appID;
			    			tempJson.applicationName=appname;
			    			tempArry.push(tempJson);
			    		}
				    	user.account[i].applicationList=tempArry;
				    	//delete the id array
				    	delete user.account[i].applicationIdList;
				    	i=i+1;
						collectAccountApplicationName(user,i,res,req);
				    }
				  });
		    }
		  });
	}
	else
		{
			var msgJson=msg.successMessage("GetUserAccess","0","Fetching useraccess Details","Fetching useraccess Details",user);
			return res.status(200).send(msgJson);
		}
}


/**
 * url :/rest/v1/adminmeta/generateCapabilityName
 * Description :Generate capabilty name as per the capabilit selection.
 * Method : POST
*/
exports.generateCapabilityName = function (req, res){
	
//var clientId = req.query.clientId;
var accessPanel=req.body.AccessPanel;
var permissions=req.body.Permissions;

var panelName;
/*logger.info('!!!!!!!!!!!!!!!!!! Client id '+clientId);
logger.info('!!!!!!!!!!!!!!!!!! accesspanel  '+accesspanel);
logger.info('!!!!!!!!!!!!!!!!!! permission '+permission);*/

if(accessPanel=='dashboard')
	panelName='Dash';
else if(accessPanel=='adminportal')
	panelName='AdmPort';
else if(accessPanel=='sopeditor')
	panelName='SopEdtr';	
	

var permissionPattern=getPermissionPattern(permissions);
//var capabilityName=clientId.substring(0,3)+panelName+permissionpattern;
var capabilityName=panelName+"-"+permissionPattern;

CapabilitiesModel.findOne({"capName":capabilityName,"trashed": 'n'}).lean().exec(function (err, capability) {
    if (err) {	
    	var errorCode=errorcodes["DBError"];
    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
    	return;
    }
    else if(!capability)
    	{
    		//return res.status(200).send(capabilityName);
    		var msgJson=msg.successMessage("createCapabilityName","0","The capability name "+capabilityName+" generated","The capability name "+capabilityName+" generated",{capabilityName:capabilityName});
            return res.status(200).send(msgJson);
    	}
    else {
          var msgJson=msg.successMessage("createCapabilityName","1","The capability name "+capabilityName+" Already exists","The capability name "+capabilityName+" Already exists",capability);
          return res.status(200).send(msgJson);
    }
  });

}

function getPermissionPattern(permissions)
{
    var permissionShortName = "";
    for (var i = 0; i &lt; permissions.length; i++)
    {
    	var permission = permissions[i];

    	switch(permission){
    	case 'Add': 
    		permissionShortName += "Add"+"|"; break;
    	case 'Update': 
    		permissionShortName += "Upd"+"|"; break;
    	case 'Delete': 
    		permissionShortName += "Del"+"|"; break;
    	case 'View': 
    		permissionShortName += "VW"+"|"; break;
    		
    	case 'ViewSelfAccounts': 
    		permissionShortName +="VW_SLF_ACC"+"|"; break; 
    	case 'ViewAllAccounts': 
    		permissionShortName += "VW_ALL_ACC"+"|"; break;
    	case 'ViewReport': 
    		permissionShortName += "VW_REP"+"|"; break;
    	case 'DownloadReport': 
    		permissionShortName += "DNLD_REP"+"|"; break;
    		
    	case 'ActivateUser': 
    		permissionShortName += "ACT_USR"+"|"; break;    	
    	case 'DeactivateUser': 
    		permissionShortName += "DACT_USR"+"|"; break;
    	case 'AddUserAccess': 
    		permissionShortName += "ADD_USR_ACS"+"|"; break;
    	case 'UpdateUserAccess': 
    		permissionShortName += "UPD_USR_ACS"+"|"; break;
    	case 'DeleteUserAccess': 
    		permissionShortName += "DEL_USR_ACS"+"|"; break;
    	case 'ViewUserAccess': 
    		permissionShortName += "VW_USR_ACS"+"|"; break;
    	case 'ExportAuditReport': 
    		permissionShortName += "EXP_AUD_REP"+"|"; break;

    	case 'ViewSelfAccounts': 
    		permissionShortName += "VW_SLF_ACC"+"|"; break;
    	case 'ViewAllAccounts': 
    		permissionShortName += "VW_ALL_ACC"+"|"; break;
    	case 'ViewReport': 
    		permissionShortName += "VW_REP"+"|"; break;

    	case 'AddRoleCap': 
    		permissionShortName += "ADD_ROLE_CAP"+"|"; break;
    	case 'UpdateRoleCap': 
    		permissionShortName += "UPD_ROLE_CAP"+"|"; break;
    	case 'DeleteRoleCap': 
    		permissionShortName += "DEL_ROLE_CAP"+"|"; break;
    	case 'ViewRoleCap': 
    		permissionShortName += "VW_ROLE_CAP"+"|"; break;
    	}
    }
    return(permissionShortName.substring(0,permissionShortName.length-1));
}



/**
 * url :/rest/v1/adminmeta/initialDataLoad
 * Description :create all the new initial records which are mandatory to run the application.
 * Method : POST
*/
exports.initialDataLoad = function (req, res){

	ClientsModel.findOne({"clientName":initdbdata.client.clientName}).lean().exec(function (err, clnt) {
		if(err)
			{
				//res.status(500).send(err);
				var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
		    	return;
			}

			else if(!clnt)
			{
				var client = new ClientsModel({
				//_id: mongoose.Types.ObjectId(),
				  clientName: initdbdata.client.clientName,
				  updateTimestamp:new Date().toISOString(),
				  trashed:'n',

			    });
			  		client.save(function (err) {
			    	if (err) {
			    	
			    	var errorCode=errorcodes["DBError"];
			    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
			    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
			    	return;
			    	} else {

			    			//Start of account+++++++++++++++++++++++++++++


			    			AccountsModel.findOne({"accountName":initdbdata.account.accountName}).lean().exec(function (err, accnt) {
		if(err)
			{
				//res.status(500).send(err);
				var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
		    	return;
			}
		else if(!accnt)
			{
			var account;
		  	
		  	account = new AccountsModel({
			//_id: mongoose.Types.ObjectId(),
			accountName: initdbdata.account.accountName,
			clientName:initdbdata.account.clientName,
			trashed:'n',
			updateTimestamp:new Date().toISOString(),
		    });
		  account.save(function (err) {
		    if (err) {
		    	
		      //return res.status(500).send(err);
		    	var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
		    } else {
		    	//*******************************APPLICATION**********************************************
		    	/*logger.info('ACCOUNTTTTTTTTTTTTTTTTTTTTTTTTTTTAVVVVVV');
		    	logger.info(account)*/
		    	ApplicationsModel.findOne({"applicationName":initdbdata.application.applicationName}).lean().exec(function (err, applicatn) {
		if(err)
			{
				//res.status(500).send(err);
			var errorCode=errorcodes["DBError"];
	       	   res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	       	   internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	       	   return;
				
			}
		else if(!applicatn)
			{
			var application;
			  application = new ApplicationsModel({
				//_id: mongoose.Types.ObjectId(),
			    applicationName: initdbdata.application.applicationName,
			    accountID: account._id,
			    updateTimestamp:new Date().toISOString(),
			    trashed:'n'
			    });
			  
			  
			  application.save(function (err) {
			    if (err) {
			    	
			    	var errorCode=errorcodes["DBError"];
      		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
      		    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
      		    	return;
			    } else {
			    	//************************************UserAccess******************************

			    	var uid=initdbdata.userAccess.userID;
	UsersAccessModel.findOne({"userID":uid}).lean().exec(function (err, users) {
	    if (err) {	
	    	//throw new Error('DBError');
	    	var errorCode=errorcodes["DBError"];
	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	internalMessage:err,userMessage:errorCode.userMessage,response:{}});
	    	return;
	    	//res.status(500).send(err);
	    }
	    else if(!users)
	    	{
	    		//var accountmapp=[];
	    		var jsonobj=[{
            			"accountId": account._id,
            			"applicationIdList": [
                				application._id
            ]
        }];

        logger.info('user structure ==========');
        logger.info(jsonobj);
	    		var user = new UsersAccessModel({
	    		//_id: mongoose.Types.ObjectId(),
	    		  userName: initdbdata.userAccess.userName,
	    		  userID:initdbdata.userAccess.userID,
	    		  roleName: initdbdata.userAccess.roleName, 
	    		  account: jsonobj, 
	    		  type: initdbdata.userAccess.type, 
	    		  active: initdbdata.userAccess.active,
	    		  updateTimestamp:new Date().toISOString(),
	    		  trashed:'n',

	    	    });
	    	  user.save(function (err) {
	    	    if (err) {
	    	    	logger.info('TEST THE BEST==========');
	    	    	logger.info(err);
	    	    	var errorCode=errorcodes["DBError"];
	    	    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
	    	    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
	    	    	return;
	    	    } else {
	    	          //*****************************dbUserCredential**********************
	    	    	
	    	    	var bcrypt = require('bcrypt-nodejs');
	    	    	var pin='pass1234';
	    	     	var hash = bcrypt.hashSync(pin);
	    	          var usercred = new UserCredentialModel({
				//_id: mongoose.Types.ObjectId(),
				  userName: initdbdata.dbUserCredential.userID,
				  password:hash,
				  trashed:'n',

			    });
			  usercred.save(function (err) {
			    if (err) {
			    	
			    	res.send(err);
			    } else {
			    	
			    	//*******************RoleCap**********************************888

			    				    	logger.info('ARIJIT =======1111111111');
	RolesModel.findOne({"roleName":initdbdata.rolecapability.roleName}).lean().exec(function (err, rol) {
		if(err)
			{
				logger.info('ARIJIT =======2222222');
				var errorCode=errorcodes["DBError"];
		    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
		    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
		    	return;
			}
		else if(!rol)
			{
				logger.info('ARIJIT =======333333333');
			var obj=initdbdata.rolecapability;
			logger.info('arijit chatterjee');
			logger.info(req.body);
			  var role = new RolesModel({
				//_id: mongoose.Types.ObjectId(),
				  roleName: initdbdata.rolecapability.roleName, 
				  updateTimestamp:new Date().toISOString(), 
				  capabilityNameList:initdbdata.rolecapability.capabilityNameList,
				  trashed:'n',

			    });
			  role.save(function (err) {
			    if (err) {
			    	var errorCode=errorcodes["DBError"];
			    	res.status(errorCode.statusCode).json({operationName:req.originalUrl,serviceCode:errorCode.serviceCode,
			    	internalMessage:err.message,userMessage:errorCode.userMessage,response:{}});
			    	return;
			    	
			    } else {
			    	
			    	var capArr = initdbdata.rolecapability.Capabilities;
			    	logger.info('My arr '+capArr);
			    	createCapability(capArr,0,res,obj,req);
			    }
			  });
			}
		else
			{
				var userMessage=userMsg.adminDuplicateRole;
				var msgJson=msg.successMessage("CreateRole","1",userMessage,userMessage,obj);
				return res.status(400).send(msgJson);
			}
	});
			    	
			    }
			  });
	    	    }
	    	  });
	    	}
	    else {
	    	  var userMessage=userMsg.adminDuplicateUser;
	    	  var msgJson=msg.successMessage("CreateUser","1",userMessage,userMessage,{});
	    	  return res.status(400).send(msgJson);
	    }
	  });
	
			    	
			    }
			  });
			}
		else
			{
				var userMessage=userMsg.sopDuplicateApplication;
				var msgJson=successMessage("CreateApplication","1",userMessage,userMessage,{});
          	    //return res.status(200).send(msgJson);
				return res.status(400).send(msgJson); 
			}
	});

		    }
		  });
		  
			}
		else
			{
				var userMessage=userMsg.sopDuplicateAccount;
				var msgJson=msg.successMessage("CreateAccount","0",userMessage,userMessage,account);
		    	  return res.status(400).send(msgJson);
				//return res.status(400).send(userMessage);
			}
	});


			    			//End of account+++++++++++++++++++++++++++++
					
					}
				});
			}
			else
			{
				var userMessage=userMsg.sopDuplicateClient;
		    	var msgJson=msg.successMessage("CreateClient","1",userMessage,userMessage,{});
		    	return res.status(400).send(msgJson);
			}
	});

}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createCapability">createCapability</a></li><li><a href="global.html#CreateRole">CreateRole</a></li><li><a href="global.html#CreateUserAccess">CreateUserAccess</a></li><li><a href="global.html#DeleteCapability">DeleteCapability</a></li><li><a href="global.html#DeleteRole">DeleteRole</a></li><li><a href="global.html#DeleteUserAccess">DeleteUserAccess</a></li><li><a href="global.html#generateCapabilityName">generateCapabilityName</a></li><li><a href="global.html#GetAllCapability">GetAllCapability</a></li><li><a href="global.html#GetAllRoleName">GetAllRoleName</a></li><li><a href="global.html#GetAllRoles">GetAllRoles</a></li><li><a href="global.html#GetAllUserAccess">GetAllUserAccess</a></li><li><a href="global.html#GetAllUserName">GetAllUserName</a></li><li><a href="global.html#GetCapability">GetCapability</a></li><li><a href="global.html#GetRole">GetRole</a></li><li><a href="global.html#GetUserAccess">GetUserAccess</a></li><li><a href="global.html#initialDataLoad">initialDataLoad</a></li><li><a href="global.html#SearchRole">SearchRole</a></li><li><a href="global.html#SearchUserAccess">SearchUserAccess</a></li><li><a href="global.html#updateCapability">updateCapability</a></li><li><a href="global.html#UpdateRole">UpdateRole</a></li><li><a href="global.html#UpdateUserAccess">UpdateUserAccess</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Mon Nov 16 2015 18:11:22 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
